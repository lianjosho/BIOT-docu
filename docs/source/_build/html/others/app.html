<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>5.- Comunicación con la APP &mdash; BIOT 0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6.- Guardado en memoria SD" href="sd.html" />
    <link rel="prev" title="4.- Tipos de sensores soportados" href="sensors.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            BIOT
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="description.html"><span class="sectnum">1.- </span>Descripción del equipo</a></li>
<li class="toctree-l1"><a class="reference internal" href="components.html"><span class="sectnum">2.- </span>Componentes del equipo</a></li>
<li class="toctree-l1"><a class="reference internal" href="firmware.html"><span class="sectnum">3.- </span>Información sobre el firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="sensors.html"><span class="sectnum">4.- </span>Tipos de sensores soportados</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"><span class="sectnum">5.- </span>Comunicación con la APP</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#actualizacion-del-rtc-interno"><span class="sectnum">5.1.- </span>Actualización del RTC interno</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuracion-del-equipo"><span class="sectnum">5.2.- </span>Configuración del equipo</a></li>
<li class="toctree-l2"><a class="reference internal" href="#palabras-clave"><span class="sectnum">5.3.- </span>Palabras clave</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#erase">erase</a></li>
<li class="toctree-l3"><a class="reference internal" href="#eeprom">eeprom</a></li>
<li class="toctree-l3"><a class="reference internal" href="#chequeo">chequeo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#voltaje-volt">voltaje,&lt;volt&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modo12">modo12</a></li>
<li class="toctree-l3"><a class="reference internal" href="#offline">offline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modulo">modulo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reset">reset</a></li>
<li class="toctree-l3"><a class="reference internal" href="#invalid-sn">invalid sn</a></li>
<li class="toctree-l3"><a class="reference internal" href="#invalid-time">invalid time</a></li>
<li class="toctree-l3"><a class="reference internal" href="#log">log</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#medicion-manual"><span class="sectnum">5.4.- </span>Medición manual</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pedido-del-historial"><span class="sectnum">5.5.- </span>Pedido del historial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sd.html"><span class="sectnum">6.- </span>Guardado en memoria SD</a></li>
<li class="toctree-l1"><a class="reference internal" href="server.html"><span class="sectnum">7.- </span>Comunicación con el servidor</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer.html"><span class="sectnum">8.- </span>Desarrollador</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html"><span class="sectnum">9.- </span>Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="bugs.html"><span class="sectnum">10.- </span>Bugs reportados</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Versionado</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BIOT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="sectnum">5.- </span>Comunicación con la APP</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/others/app.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="comunicacion-con-la-app">
<h1><a class="toc-backref" href="#id1" role="doc-backlink"><span class="sectnum">5.- </span>Comunicación con la APP</a><a class="headerlink" href="#comunicacion-con-la-app" title="Permalink to this heading"></a></h1>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="auto-toc simple">
<li><p><a class="reference internal" href="#comunicacion-con-la-app" id="id1"><span class="sectnum">5.- </span>Comunicación con la APP</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#actualizacion-del-rtc-interno" id="id2"><span class="sectnum">5.1.- </span>Actualización del RTC interno</a></p></li>
<li><p><a class="reference internal" href="#configuracion-del-equipo" id="id3"><span class="sectnum">5.2.- </span>Configuración del equipo</a></p></li>
<li><p><a class="reference internal" href="#palabras-clave" id="id4"><span class="sectnum">5.3.- </span>Palabras clave</a></p>
<ul>
<li><p><a class="reference internal" href="#erase" id="id5">erase</a></p></li>
<li><p><a class="reference internal" href="#eeprom" id="id6">eeprom</a></p></li>
<li><p><a class="reference internal" href="#chequeo" id="id7">chequeo</a></p></li>
<li><p><a class="reference internal" href="#voltaje-volt" id="id8">voltaje,&lt;volt&gt;</a></p></li>
<li><p><a class="reference internal" href="#modo12" id="id9">modo12</a></p></li>
<li><p><a class="reference internal" href="#offline" id="id10">offline</a></p></li>
<li><p><a class="reference internal" href="#modulo" id="id11">modulo</a></p></li>
<li><p><a class="reference internal" href="#reset" id="id12">reset</a></p></li>
<li><p><a class="reference internal" href="#invalid-sn" id="id13">invalid sn</a></p></li>
<li><p><a class="reference internal" href="#invalid-time" id="id14">invalid time</a></p></li>
<li><p><a class="reference internal" href="#log" id="id15">log</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#medicion-manual" id="id16"><span class="sectnum">5.4.- </span>Medición manual</a></p></li>
<li><p><a class="reference internal" href="#pedido-del-historial" id="id17"><span class="sectnum">5.5.- </span>Pedido del historial</a></p></li>
</ul>
</li>
</ul>
</nav>
<p class="linemarker linemarker-11">Cuando el celular está conectado al equipo, éste puede
atender las siguientes peticiones:</p>
<p class="linemarker linemarker-14">[enlace](variables/archivo.wsd)</p>
<ul class="simple">
<li><p class="linemarker linemarker-16">Actualización del RTC interno</p></li>
<li><p class="linemarker linemarker-17">Configuración del equipo</p></li>
<li><p class="linemarker linemarker-18">Palabras clave</p></li>
<li><p class="linemarker linemarker-19">Medición manual</p></li>
<li><p class="linemarker linemarker-20">Pedido del historial</p></li>
</ul>
<section id="actualizacion-del-rtc-interno">
<h2><a class="toc-backref" href="#id2" role="doc-backlink"><span class="sectnum">5.1.- </span>Actualización del RTC interno</a><a class="headerlink" href="#actualizacion-del-rtc-interno" title="Permalink to this heading"></a></h2>
<p class="linemarker linemarker-25">El HTTP request es el siguiente:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/updateDate</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">user-agent</span><span class="o">:</span> <span class="l">Dart/2.16 (dart:io)</span>
<span class="na">content-type</span><span class="o">:</span> <span class="l">text/plain; charset=utf-8</span>
<span class="na">accept-encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">content-length</span><span class="o">:</span> <span class="l">36</span>
<span class="na">host</span><span class="o">:</span> <span class="l">192.168.4.1</span>


&quot;{date: 2022-12-13T21:07:33.803604}&quot;
</pre></div>
</div>
<p class="linemarker linemarker-39">Con esta información, se actualiza el RTC externo y se pone
en hora también el RTC interno. Después de esto, le manda a
la app el siguiente HTTP response:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span><span class="l">text/plain;charset=UTF-8</span>

V5.0.1
</pre></div>
</div>
<p class="linemarker linemarker-50">Donde va la información de la versión del firmware.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p class="linemarker linemarker-54">Cada vez que el ESP32 se queda sin suministro eléctrico,
el RTC vuelve al epoch time (1 de enero de 1970 a las 0hs),
es por eso que se sincroniza con el RTC externo (DS3231)
cada vez que se despierta.</p>
</div>
</section>
<section id="configuracion-del-equipo">
<h2><a class="toc-backref" href="#id3" role="doc-backlink"><span class="sectnum">5.2.- </span>Configuración del equipo</a><a class="headerlink" href="#configuracion-del-equipo" title="Permalink to this heading"></a></h2>
<p class="linemarker linemarker-62">El HTTP request es el siguiente:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/setConfig</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">user-agent</span><span class="o">:</span> <span class="l">Dart/2.16 (dart:io)</span>
<span class="na">content-type</span><span class="o">:</span> <span class="l">application/json; charset=utf-8</span>
<span class="na">accept-encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">content-length</span><span class="o">:</span> <span class="l">158</span>
<span class="na">host</span><span class="o">:</span> <span class="l">192.168.4.1</span>

<span class="s2">&quot;{\&quot;soil_type\&quot;: \&quot;Arcillo arenoso\&quot;, \&quot;location_name\&quot;: \&quot;eeprom\&quot;, \&quot;sensors\&quot;: {\&quot;Salida1(o1)\&quot;: {\&quot;type\&quot;: \&quot;the\&quot;, \&quot;tag_depth\&quot;: 10 }}, \&quot;location\&quot;: {\&quot;latitude\&quot;: -31.4402331, \&quot;longitude\&quot;: -64.2040826}}&quot;</span>
</pre></div>
</div>
<p class="linemarker linemarker-75">Si todo sale bien, entonces el http response es:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span><span class="l">text/plain;charset=UTF-8</span>

Equipo configurado
==================
 · 1) 10.00 cm (the)
 · 2) No configurado
 · 3) No configurado
 · 4) No configurado
</pre></div>
</div>
</section>
<section id="palabras-clave">
<h2><a class="toc-backref" href="#id4" role="doc-backlink"><span class="sectnum">5.3.- </span>Palabras clave</a><a class="headerlink" href="#palabras-clave" title="Permalink to this heading"></a></h2>
<p class="linemarker linemarker-335">Si el campo <code class="docutils literal notranslate"><span class="pre">location_name</span></code> tiene alguna de las siguientes
palabras reservadas, entonces el equipo no hace la
configuración y atiende ese caso especial.</p>
<ul class="simple">
<li><p class="linemarker linemarker-339">erase</p></li>
<li><p class="linemarker linemarker-340">eeprom</p></li>
<li><p class="linemarker linemarker-341">chequeo</p></li>
<li><p class="linemarker linemarker-342">voltaje,&lt;bat_level&gt;</p></li>
<li><p class="linemarker linemarker-343">modo12</p></li>
<li><p class="linemarker linemarker-344">offline</p></li>
<li><p class="linemarker linemarker-345">modulo</p></li>
<li><p class="linemarker linemarker-346">reset</p></li>
<li><p class="linemarker linemarker-347">invalid sn</p></li>
<li><p class="linemarker linemarker-348">invalid time</p></li>
<li><p class="linemarker linemarker-349">log</p></li>
</ul>
<section id="erase">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">erase</a><a class="headerlink" href="#erase" title="Permalink to this heading"></a></h3>
<p class="linemarker linemarker-354">Borra la configuración del equipo, excepto:</p>
<ul class="simple">
<li><p class="linemarker linemarker-356"><code class="docutils literal notranslate"><span class="pre">mac</span></code>;</p></li>
<li><p class="linemarker linemarker-357"><code class="docutils literal notranslate"><span class="pre">firm_vers</span></code>;</p></li>
<li><p class="linemarker linemarker-358"><code class="docutils literal notranslate"><span class="pre">volt_coeff</span></code> y</p></li>
<li><p class="linemarker linemarker-359"><code class="docutils literal notranslate"><span class="pre">unix_time</span></code>.</p></li>
</ul>
<p class="linemarker linemarker-361">El http_response es:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span><span class="l">text/plain;charset=UTF-8</span>

La configuración ha sido borrada
</pre></div>
</div>
</section>
<section id="eeprom">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">eeprom</a><a class="headerlink" href="#eeprom" title="Permalink to this heading"></a></h3>
<p class="linemarker linemarker-373">Devuelve un json con la configuración del equipo en
formato json.</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span><span class="l">text/plain;charset=UTF-8</span>
</pre></div>
</div>
<p class="linemarker linemarker-383">Donde el json devuelto es igual al <code class="docutils literal notranslate"><span class="pre">json_pp</span></code>, excepto que
a los campos de las salidas se le agrega un campo llamado
<code class="docutils literal notranslate"><span class="pre">other</span></code> que contiene información adicional. El tiempo que
demora la respuesta es <strong>258 ms</strong> aproximadamente.</p>
</section>
<section id="chequeo">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">chequeo</a><a class="headerlink" href="#chequeo" title="Permalink to this heading"></a></h3>
<p class="linemarker linemarker-391">Hace un chequeo de los módulos RTC externo y SD y las
salidas. Luego le envía a la app un mensaje con el
resultado del chequeo.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>HTTP/1.1<span class="w"> </span><span class="m">200</span><span class="w"> </span>OK
Content-Type:text/plain<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>UTF-8

Chequeo:
<span class="o">========</span>
-<span class="w"> </span>Tarjeta<span class="w"> </span>SD:<span class="w"> </span>ok
-<span class="w"> </span>Reloj<span class="w"> </span>externo:<span class="w"> </span>ok
-<span class="w"> </span>Salidas:
<span class="w"> </span>·<span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>ok
<span class="w"> </span>·<span class="w"> </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>No<span class="w"> </span>configurado
<span class="w"> </span>·<span class="w"> </span><span class="m">3</span><span class="o">)</span><span class="w"> </span>No<span class="w"> </span>configurado
<span class="w"> </span>·<span class="w"> </span><span class="m">4</span><span class="o">)</span><span class="w"> </span>No<span class="w"> </span>configurado
-<span class="w"> </span>Modo<span class="w"> </span><span class="m">12</span>:<span class="w"> </span>No
-<span class="w"> </span>Modo<span class="w"> </span>offline:<span class="w"> </span>Sí
-<span class="w"> </span>Mediciones<span class="w"> </span>guardadas:<span class="w"> </span><span class="m">8</span>
</pre></div>
</div>
</section>
<section id="voltaje-volt">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">voltaje,&lt;volt&gt;</a><a class="headerlink" href="#voltaje-volt" title="Permalink to this heading"></a></h3>
<p class="linemarker linemarker-416">Configura el coeficiente de voltaje, donde &lt;volt&gt; es el
valor de voltaje de la batería en ese momento. La HTTP response es:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>HTTP/1.1<span class="w"> </span><span class="m">200</span><span class="w"> </span>OK
Content-Type:text/plain<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>UTF-8

Coeficiente<span class="w"> </span>de<span class="w"> </span>voltaje<span class="w"> </span>seteado<span class="w"> </span>en<span class="w"> </span><span class="m">1</span>.00
</pre></div>
</div>
</section>
<section id="modo12">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">modo12</a><a class="headerlink" href="#modo12" title="Permalink to this heading"></a></h3>
<p class="linemarker linemarker-429">Activa o desactiva el modo 12.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>HTTP/1.1<span class="w"> </span><span class="m">200</span><span class="w"> </span>OK
Content-Type:text/plain<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>UTF-8

Modo<span class="w"> </span><span class="m">12</span>:
<span class="w"> </span>·<span class="w"> </span>Medición<span class="w"> </span>cada<span class="w"> </span><span class="m">1</span><span class="w"> </span>hs
<span class="w"> </span>·<span class="w"> </span>Envío<span class="w"> </span>cada<span class="w"> </span><span class="m">12</span><span class="w"> </span>hs
<span class="w"> </span>·<span class="w"> </span>Envíos<span class="w"> </span>a<span class="w"> </span>la<span class="w"> </span><span class="m">00</span>:00<span class="w"> </span>y<span class="w"> </span><span class="m">12</span>:00<span class="w"> </span>hs
</pre></div>
</div>
</section>
<section id="offline">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">offline</a><a class="headerlink" href="#offline" title="Permalink to this heading"></a></h3>
<p class="linemarker linemarker-444">Des/activa modo offline. Si el equipo estaba con el modo offline
desactivado, lo activa y devuelve:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span><span class="l">text/plain;charset=UTF-8</span>

Modo offline: las mediciones NO se envían, sólo se guardan
</pre></div>
</div>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span><span class="l">text/plain;charset=UTF-8</span>

Modo online: las mediciones se envían normalmente
</pre></div>
</div>
</section>
<section id="modulo">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">modulo</a><a class="headerlink" href="#modulo" title="Permalink to this heading"></a></h3>
<p class="linemarker linemarker-464">Borra el contenido del archivo “register.txt”, que es en donde se
guardan las mediciones fallidas. El http_response es:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span><span class="l">text/plain;charset=UTF-8</span>

Memoria SD formateada. Mediciones guardadas eliminadas
</pre></div>
</div>
</section>
<section id="reset">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">reset</a><a class="headerlink" href="#reset" title="Permalink to this heading"></a></h3>
<p class="linemarker linemarker-477">Reinicia el equipo. El esp32 se apaga y se vuelve a encender. Para
seguir configurando el equipo, se debe volver a generar la red wifi.</p>
</section>
<section id="invalid-sn">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">invalid sn</a><a class="headerlink" href="#invalid-sn" title="Permalink to this heading"></a></h3>
<p class="linemarker linemarker-483">Se quita los 0 en el campo “sn” del json de medición que se va a
enviar al servidor. Esto se hace para testear la respuesta del
mismo a un json formado con un sn inválido.</p>
<p class="linemarker linemarker-487">El http_response es:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span><span class="l">text/plain;charset=UTF-8</span>

El json de medición se va a armar con un sn inválido
</pre></div>
</div>
<p class="linemarker linemarker-496">Y si se vuelve a mandar la palabra clave, devuelve:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span><span class="l">text/plain;charset=UTF-8</span>

El json de medición se va a armar normal
</pre></div>
</div>
</section>
<section id="invalid-time">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">invalid time</a><a class="headerlink" href="#invalid-time" title="Permalink to this heading"></a></h3>
<p class="linemarker linemarker-508">Se manda un timestamp con el a{o 2025 en el json de medición que
se va a enviar al servidor. Esto se hace para testear la respuesta
del mismo a un json formado con un timestamp inválido.</p>
<p class="linemarker linemarker-512">El http_response es:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span><span class="l">text/plain;charset=UTF-8</span>

El json de medición se va a armar con un timestamp inválido
</pre></div>
</div>
<p class="linemarker linemarker-521">Y si se vuelve a mandar la palabra clave, devuelve:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span><span class="l">text/plain;charset=UTF-8</span>

El json de medición se va a armar normal
</pre></div>
</div>
</section>
<section id="log">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">log</a><a class="headerlink" href="#log" title="Permalink to this heading"></a></h3>
<p class="linemarker linemarker-533">Devuelve a la app el archivo <code class="docutils literal notranslate"><span class="pre">activity.txt</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p class="linemarker linemarker-536">Con esta palabra se debe hacer la petición con Packet Sender o
programa similar, pues el archivo es muy extensos para que la
app los muestre.</p>
</div>
</section>
</section>
<section id="medicion-manual">
<h2><a class="toc-backref" href="#id16" role="doc-backlink"><span class="sectnum">5.4.- </span>Medición manual</a><a class="headerlink" href="#medicion-manual" title="Permalink to this heading"></a></h2>
<p class="linemarker linemarker-543">La HTTP request es:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/requestMeasuring</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">user-agent</span><span class="o">:</span> <span class="l">Dart/2.16 (dart:io)</span>
<span class="na">content-type</span><span class="o">:</span> <span class="l">application/json; charset=utf-8</span>
<span class="na">accept-encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">content-length</span><span class="o">:</span> <span class="l">2</span>
<span class="na">host</span><span class="o">:</span> <span class="l">192.168.4.1</span>


<span class="p">{}</span>
</pre></div>
</div>
<p class="linemarker linemarker-557">La HTTP_response es:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span><span class="l">text/plain;charset=UTF-8</span>

Resultado
=========
· 1) Sensor the
    T = 19.43°C
    H = 0.45%RH
    EC = 0uS/cm
    Envío: FALLÓ
    Guardado: ok
· 2) Sensor the
    T = 19.42°C
    H = 0.34%RH
    EC = 0uS/cm
    Envío: FALLÓ
    Guardado: ok
· 3) Sensor the
    T = 19.59°C
    H = 0.34%RH
    EC = 0uS/cm
    Envío: FALLÓ
    Guardado: ok
· 4) Sensor the
    T = 19.54°C
    H = 0.22%RH
    EC = 0uS/cm
    Envío: FALLÓ
    Guardado: ok
Enviados desde SD: 0
Quedan en la SD: 4
</pre></div>
</div>
<p class="linemarker linemarker-593">Donde cada salida corresponde a lo siguiente:</p>
<ul>
<li><p class="linemarker linemarker-595">Encabezado: tiene el número de la salida y el tipo de sensor.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">· 4) Sensor the</span>
</pre></div>
</div>
</li>
<li><p class="linemarker linemarker-601">Parámetros: son las mediciones en sí. Para un sensor “THE”:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">T = 19.54°C</span>
<span class="go">H = 0.22%RH</span>
<span class="go">EC = 0uS/cm</span>
</pre></div>
</div>
<p class="linemarker linemarker-609">Para un sensor “NPK”:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">T = 19.54°C</span>
<span class="go">H = 0.22%RH</span>
<span class="go">EC = 0uS/cm</span>
<span class="go">N = 19mg/kg</span>
<span class="go">P = 39mg/kg</span>
<span class="go">K = 29mg/kg</span>
</pre></div>
</div>
<p class="linemarker linemarker-620">Y para un sensor “de nivel”:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">L = 4.5 metros</span>
</pre></div>
</div>
</li>
<li><p class="linemarker linemarker-626">Envío y guardado: es el resultado del envío y guardado del
paquete de la salida en cuestión.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Envío: ok o FALLÓ</span>
<span class="go">Guardado: ok o FALLÓ</span>
</pre></div>
</div>
</li>
</ul>
<p class="linemarker linemarker-634">Por último, se muestran las mediciones guardadas, que son el
resultado del envío de las mediciones que habían guardadas
en la SD. Si no se pueden enviar, seguirán en la SD.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Enviados desde SD: 0</span>
<span class="go">Quedan en la SD: 4</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p class="linemarker linemarker-645">Los paquetes en la SD con más de 3 envíos fallidos se
borrarán de la misma.</p>
</div>
</section>
<section id="pedido-del-historial">
<h2><a class="toc-backref" href="#id17" role="doc-backlink"><span class="sectnum">5.5.- </span>Pedido del historial</a><a class="headerlink" href="#pedido-del-historial" title="Permalink to this heading"></a></h2>
<p class="linemarker linemarker-651">El HTTP request es:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/getHistory</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">user-agent</span><span class="o">:</span> <span class="l">Dart/2.16 (dart:io)</span>
<span class="na">content-type</span><span class="o">:</span> <span class="l">application/json; charset=utf-8</span>
<span class="na">accept-encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">content-length</span><span class="o">:</span> <span class="l">2</span>
<span class="na">host</span><span class="o">:</span> <span class="l">192.168.4.1</span>


<span class="p">{}</span>
</pre></div>
</div>
<p class="linemarker linemarker-665">Y la HTTP response es un array de json:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>HTTP/1.1<span class="w"> </span><span class="m">200</span><span class="w"> </span>OK
Content-type:<span class="w"> </span>application/json

<span class="o">[</span><span class="w"> </span>json_measure_0,<span class="w"> </span>json_measure_1,<span class="w"> </span>...<span class="w"> </span><span class="o">]</span>
</pre></div>
</div>
<p class="linemarker linemarker-674">El ESP32 manda un json cada vez porque tiene un límite de
alrededor de 1400 caracteres por envío al cliente.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p class="linemarker linemarker-679">Después de descargar los datos, el archivo <code class="docutils literal notranslate"><span class="pre">register.txt</span></code>
no se elimina, sólo lo hará cuando el equipo pueda mandar
con éxito dichas mediciones vía sim800 o se hayan
intentado mandar 3 veces sin éxito.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="sensors.html" class="btn btn-neutral float-left" title="4.- Tipos de sensores soportados" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="sd.html" class="btn btn-neutral float-right" title="6.- Guardado en memoria SD" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, BristeFirmware.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>